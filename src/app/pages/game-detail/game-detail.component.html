<app-header />

<!-- Back Button -->
<div class="max-w-7xl mx-auto px-6 py-6">
  <app-back-button backRoute="/store" label="Voltar para a Loja" />
</div>

<!-- Game Details -->
<div class="max-w-7xl mx-auto px-6 pb-16" *ngIf="detail() as game; else loading">
  <!-- Hero Section -->
  <div class="relative mb-12 rounded-2xl overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-t from-slate-950/90 via-slate-900/40 to-transparent"></div>
    <img 
      [src]="game.header_image" 
      [alt]="game.name" 
      class="w-full h-[500px] object-cover"
      (error)="onImageError($event)"
      appScrollReveal
    />
    <div class="absolute bottom-8 left-8 right-8">
      <h1 class="text-5xl md:text-6xl font-bold text-slate-100 mb-4 drop-shadow-2xl" appScrollReveal>{{ game.name }}</h1>
      <p class="text-slate-200 text-xl max-w-3xl leading-relaxed" [innerHTML]="game.short_description" appScrollReveal></p>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="grid lg:grid-cols-3 gap-12">
    <!-- Left Column - Game Info -->
    <div class="lg:col-span-2 space-y-8">
      <!-- About the Game -->
      <div class="bg-slate-800/30 backdrop-blur-sm p-8 rounded-2xl border border-slate-700/30" appScrollReveal>
        <h2 class="text-3xl font-bold mb-6 text-slate-100">Sobre o Jogo</h2>
        <div class="prose prose-invert max-w-none text-lg leading-relaxed text-slate-300" [innerHTML]="game.about_the_game"></div>
      </div>

      <!-- Screenshots -->
      <div *ngIf="game.screenshots?.length" class="bg-slate-800/30 backdrop-blur-sm p-8 rounded-2xl border border-slate-700/30" appScrollReveal>
        <h2 class="text-3xl font-bold mb-6 text-slate-100">Screenshots</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
          <div 
            *ngFor="let screenshot of game.screenshots; let i = index" 
            class="group cursor-pointer overflow-hidden rounded-xl"
            appScrollReveal [revealDelay]="i * 100"
          >
            <img 
              [src]="screenshot.path_thumbnail" 
              [alt]="'Screenshot de ' + game.name"
              class="w-full h-48 object-cover transition-all duration-300 group-hover:scale-110 group-hover:opacity-80"
              (click)="openImage(screenshot.path_full)"
              (error)="onImageError($event)"
            />
          </div>
        </div>
      </div>

      <!-- Videos/Trailers -->
      <div *ngIf="game.movies?.length" class="bg-slate-800/30 backdrop-blur-sm p-8 rounded-2xl border border-slate-700/30" appScrollReveal>
        <h2 class="text-3xl font-bold mb-6 text-slate-100">Vídeos e Trailers</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div *ngFor="let movie of game.movies; let i = index" class="space-y-3" appScrollReveal [revealDelay]="i * 100">
            <div class="relative overflow-hidden rounded-xl">
              <img 
                [src]="movie.thumbnail" 
                [alt]="movie.name" 
                class="w-full h-48 object-cover transition-all duration-300 hover:scale-105"
                (error)="onImageError($event)"
              />
              <div class="absolute inset-0 bg-slate-900/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300">
                <span class="material-symbols-outlined text-4xl text-white">play_circle</span>
              </div>
            </div>
            <h3 class="font-semibold text-lg text-slate-200">{{ movie.name }}</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Game Details -->
    <div class="space-y-8">
      <!-- Price & Purchase -->
      <div class="bg-slate-800/30 backdrop-blur-sm p-8 rounded-2xl border border-slate-700/30" appScrollReveal>
        <div class="text-center">
          <div *ngIf="game.is_free" class="text-3xl font-bold text-green-400 mb-4">
            Gratuito para Jogar
          </div>
          <div *ngIf="!game.is_free && game.price_overview" class="space-y-3 mb-6">
            <div *ngIf="game.price_overview.discount_percent > 0" class="text-lg text-green-400 font-semibold">
              -{{ game.price_overview.discount_percent }}% OFF
            </div>
            <div class="text-4xl font-bold text-slate-100">
              {{ game.price_overview.final_formatted }}
            </div>
          </div>
          <button class="w-full px-6 py-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-bold rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all duration-300 hover:scale-105 shadow-lg">
            Adicionar ao Carrinho
          </button>
        </div>
      </div>

      <!-- Game Info -->
      <div class="bg-slate-800/30 backdrop-blur-sm p-8 rounded-2xl border border-slate-700/30 space-y-6" appScrollReveal>
        <h3 class="text-2xl font-bold text-slate-100 mb-6">Informações do Jogo</h3>
        
        <!-- Genres -->
        <div *ngIf="game.genres?.length">
          <h4 class="text-sm text-slate-400 mb-3 font-medium">Gêneros</h4>
          <div class="flex flex-wrap gap-2">
            <span *ngFor="let genre of game.genres" class="px-4 py-2 bg-slate-700/50 hover:bg-slate-600/50 rounded-full text-sm border border-slate-600/50 transition-all duration-300 hover:scale-105 text-slate-200">
              {{ genre.description }}
            </span>
          </div>
        </div>

        <!-- Categories -->
        <div *ngIf="game.categories?.length">
          <h4 class="text-sm text-slate-400 mb-3 font-medium">Categorias</h4>
          <div class="flex flex-wrap gap-2">
            <span *ngFor="let category of game.categories" class="px-4 py-2 bg-slate-700/50 hover:bg-slate-600/50 rounded-full text-sm border border-slate-600/50 transition-all duration-300 hover:scale-105 text-slate-200">
              {{ category.description }}
            </span>
          </div>
        </div>

        <!-- Platforms -->
        <div *ngIf="game.platforms">
          <h4 class="text-sm text-slate-400 mb-3 font-medium">Plataformas</h4>
          <div class="flex gap-3">
            <span *ngIf="game.platforms.windows" class="px-4 py-2 bg-blue-500/20 text-blue-300 rounded-lg text-sm border border-blue-500/30">
              Windows
            </span>
            <span *ngIf="game.platforms.mac" class="px-4 py-2 bg-slate-500/20 text-slate-300 rounded-lg text-sm border border-slate-500/30">
              Mac
            </span>
            <span *ngIf="game.platforms.linux" class="px-4 py-2 bg-orange-500/20 text-orange-300 rounded-lg text-sm border border-orange-500/30">
              Linux
            </span>
          </div>
        </div>

        <!-- Release Date -->
        <div *ngIf="game.release_date?.date">
          <h4 class="text-sm text-slate-400 mb-3 font-medium">Data de Lançamento</h4>
          <p class="text-slate-200 text-lg">{{ game.release_date?.date | date:'dd/MM/yyyy' }}</p>
        </div>

        <!-- Metacritic Score -->
        <div *ngIf="game.metacritic?.score && game.metacritic?.url">
          <h4 class="text-sm text-slate-400 mb-3 font-medium">Metacritic</h4>
          <div class="flex items-center gap-3">
            <span class="px-4 py-2 bg-yellow-500/20 text-yellow-300 rounded-lg text-lg font-bold border border-yellow-500/30">
              {{ game.metacritic?.score }}
            </span>
            <a [href]="game.metacritic?.url" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline text-sm transition-colors">
              Ver avaliação
            </a>
          </div>
        </div>
      </div>

      <!-- External Links -->
      <div *ngIf="game.website" class="bg-slate-800/30 backdrop-blur-sm p-8 rounded-2xl border border-slate-700/30" appScrollReveal>
        <h3 class="text-2xl font-bold text-slate-100 mb-6">Links Externos</h3>
        <a 
          [href]="game.website" 
          target="_blank" 
          rel="noopener noreferrer"
          class="inline-flex items-center gap-3 px-6 py-3 bg-slate-700/50 hover:bg-slate-600/50 rounded-xl transition-all duration-300 hover:scale-105 border border-slate-600/50 text-slate-200"
        >
          <span class="material-symbols-outlined">language</span>
          Site Oficial
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Loading Template -->
<ng-template #loading>
  <div class="max-w-7xl mx-auto px-6 py-16">
    <div *ngIf="loading" class="text-center py-16" appScrollReveal>
      <div class="inline-flex items-center justify-center w-24 h-24 bg-slate-800/50 rounded-full border border-slate-600/50 mb-6">
        <span class="material-symbols-outlined text-4xl text-orange-400 animate-spin">refresh</span>
      </div>
      <p class="text-xl text-slate-300">Carregando detalhes do jogo...</p>
    </div>
    
    <div *ngIf="error" class="text-center py-16" appScrollReveal>
      <div class="inline-flex items-center justify-center w-24 h-24 bg-slate-800/50 rounded-full border border-slate-600/50 mb-6">
        <span class="material-symbols-outlined text-4xl text-red-400">error</span>
      </div>
      <h2 class="text-3xl font-bold mb-4 text-slate-100">Erro ao carregar</h2>
      <p class="text-slate-300 mb-8 text-lg">Não foi possível carregar os detalhes deste jogo.</p>
      <app-back-button backRoute="/store" label="Voltar para a Loja" />
    </div>
  </div>
</ng-template>


